# 包装方式

<cite>
**本文档引用的文件**  
- [PackageTypeApi.java](file://eplus-module-pms/eplus-module-pms-api/src/main/java/com/syj/eplus/module/pms/api/packageType/PackageTypeApi.java)
- [PackageTypeApiImpl.java](file://eplus-module-pms/eplus-module-pms-biz/src/main/java/com/syj/eplus/module/pms/api/PackageTypeApiImpl.java)
- [PackageTypeDTO.java](file://eplus-module-pms/eplus-module-pms-api/src/main/java/com/syj/eplus/module/pms/api/packageType/dto/PackageTypeDTO.java)
- [PackageTypeSaveReqVO.java](file://eplus-module-pms/eplus-module-pms-biz/src/main/java/com/syj/eplus/module/pms/controller/admin/packagetype/vo/PackageTypeSaveReqVO.java)
- [SkuDTO.java](file://eplus-module-pms/eplus-module-pms-api/src/main/java/com/syj/eplus/module/pms/api/sku/dto/SkuDTO.java)
- [SkuDO.java](file://eplus-module-pms/eplus-module-pms-biz/src/main/java/com/syj/eplus/module/pms/dal/dataobject/sku/SkuDO.java)
- [PurchaseContractItemDO.java](file://eplus-module-scm/eplus-module-scm-biz/src/main/java/com/syj/eplus/module/scm/dal/dataobject/purchasecontractitem/PurchaseContractItemDO.java)
- [PurchaseContractItemAndContractInfoRespVO.java](file://eplus-module-scm/eplus-module-scm-biz/src/main/java/com/syj/eplus/module/scm/controller/admin/purchasecontractitem/vo/PurchaseContractItemAndContractInfoRespVO.java)
- [QualityInspectionItemSaveReqVO.java](file://eplus-module-qms/eplus-module-qms-biz/src/main/java/com/syj/eplus/module/qms/controller/admin/qualityinspection/vo/QualityInspectionItemSaveReqVO.java)
- [TransformNoticeMidVO.java](file://eplus-module-scm/eplus-module-scm-biz/src/main/java/com/syj/eplus/module/scm/controller/admin/purchasecontract/vo/TransformNoticeMidVO.java)
- [CalcSaleContactUtil.java](file://eplus-module-sms/eplus-module-sms-biz/src/main/java/com/syj/eplus/module/sms/util/CalcSaleContactUtil.java)
- [PurchaseContractServiceImpl.java](file://eplus-module-scm/eplus-module-scm-biz/src/main/java/com/syj/eplus/module/scm/service/purchasecontract/PurchaseContractServiceImpl.java)
</cite>

## 目录
1. [引言](#引言)
2. [包装方式数据模型设计](#包装方式数据模型设计)
3. [包装方式与SKU的关联关系](#包装方式与sku的关联关系)
4. [包装方式在业务流程中的应用场景](#包装方式在业务流程中的应用场景)
5. [包装方式变更管理方案](#包装方式变更管理方案)
6. [结论](#结论)

## 引言

包装方式是企业供应链管理中的核心数据模型之一，贯穿于产品设计、报价、采购、物流、质检等多个业务环节。本文档旨在全面说明包装方式数据模型的设计原理，包括包装类型、规格参数、成本计算等字段的定义，阐述包装方式与SKU的关联机制，并详细描述其在报价、采购、物流等场景中的应用。同时，本文档将提供包装方式变更管理的实现方案，确保在变更发生时，历史单据的数据一致性得到保障。

## 包装方式数据模型设计

包装方式数据模型的设计主要围绕包装类型定义、规格参数和成本计算三个核心维度展开。该模型通过独立的“包装方式”实体进行管理，并通过关联字段与SKU及其他业务单据建立联系。

### 包装类型定义

包装方式的核心是包装类型，它定义了产品包装的标准化分类。系统通过`PackageType`实体来管理所有可用的包装类型。

- **主键 (id)**: 包装方式的唯一标识符，为长整型。
- **编号 (code)**: 包装方式的内部编码，用于系统内快速引用。
- **名称 (name)**: 包装方式的中文名称，如“彩盒”、“吸塑”、“白盒”等。
- **英文名称 (nameEng)**: 包装方式的英文名称，用于国际化场景。

该实体通过`PackageTypeApi`接口对外提供服务，支持根据ID、ID列表或获取所有包装类型的列表，为其他模块提供数据支持。

**Section sources**
- [PackageTypeApi.java](file://eplus-module-pms/eplus-module-pms-api/src/main/java/com/syj/eplus/module/pms/api/packageType/PackageTypeApi.java)
- [PackageTypeDTO.java](file://eplus-module-pms/eplus-module-pms-api/src/main/java/com/syj/eplus/module/pms/api/packageType/dto/PackageTypeDTO.java)
- [PackageTypeSaveReqVO.java](file://eplus-module-pms/eplus-module-pms-biz/src/main/java/com/syj/eplus/module/pms/controller/admin/packagetype/vo/PackageTypeSaveReqVO.java)

### 规格参数

包装的规格参数是描述包装物理特性的关键数据，这些参数通常与具体的SKU或采购合同项相关联，而非直接存储在包装类型定义中。这允许同一包装类型在不同产品上应用时，拥有不同的具体规格。

- **内箱装量 (qtyPerInnerbox)**: 每个内箱可容纳的产品数量。
- **外箱装量 (qtyPerOuterbox)**: 每个外箱可容纳的产品数量。
- **包装规格长宽高 (packageLength, packageWidth, packageHeight)**: 包装箱的外部尺寸，单位为毫米（mm）或其他标准单位。
- **包装规格单位 (packageUnit)**: 尺寸的计量单位。
- **单品毛重 (singleGrossweight)**: 单个产品（含包装）的重量，使用`JsonWeight`对象存储，包含数值和单位。

这些字段通常出现在采购合同、质检单等业务单据的明细项中，用于精确描述该批次产品的包装情况。

**Section sources**
- [TransformNoticeMidVO.java](file://eplus-module-scm/eplus-module-scm-biz/src/main/java/com/syj/eplus/module/scm/controller/admin/purchasecontract/vo/TransformNoticeMidVO.java)
- [PurchaseContractItemPageReqVO.java](file://eplus-module-scm/eplus-module-scm-biz/src/main/java/com/syj/eplus/module/scm/controller/admin/purchasecontractitem/vo/PurchaseContractItemPageReqVO.java)

### 成本计算

包装成本是产品总成本的重要组成部分，系统通过专门的字段来记录和计算包装相关的费用。

- **包装价 (packagingPrice)**: 每个包装单位（如每个彩盒）的成本，使用`JsonAmount`对象存储，包含金额数值和币种信息。
- **运费计算**: 在销售合同计算中，系统会根据预估总运费、外箱体积、箱数和总体积等参数，按比例分摊计算出该产品的预估总费用。

成本计算逻辑通常在业务服务层（如`CalcSaleContactUtil`）中实现，确保成本核算的准确性和一致性。

**Section sources**
- [TransformNoticeMidVO.java](file://eplus-module-scm/eplus-module-scm-biz/src/main/java/com/syj/eplus/module/scm/controller/admin/purchasecontract/vo/TransformNoticeMidVO.java)
- [CalcSaleContactUtil.java](file://eplus-module-sms/eplus-module-sms-biz/src/main/java/com/syj/eplus/module/sms/util/CalcSaleContactUtil.java)

## 包装方式与SKU的关联关系

包装方式与SKU的关联并非通过直接的数据库外键实现，而是采用了一种更灵活的“多对多”关联模式，主要通过业务单据作为中介来建立联系。

### 关联模型

1.  **SKU实体**: SKU（库存单位）实体本身不直接存储包装方式。它包含产品基础信息，如名称、规格、材质等。
2.  **包装方式实体**: `PackageType`实体独立管理所有包装类型。
3.  **业务单据作为关联载体**: 在采购合同、销售合同、质检单等具体业务单据的明细项中，通过`packageType`字段来关联一个或多个包装方式。

例如，在`PurchaseContractItemDO`（采购合同明细项）中，`packageType`字段被定义为`List<Long>`，表示一个采购项可以关联多个包装方式。同时，为了方便展示，还包含`packageTypeName`和`packageTypeEngName`字段来存储包装方式的名称，这些是冗余字段，由系统在保存时根据`packageType` ID列表自动填充。

```mermaid
erDiagram
SKU {
Long id PK
String code
String name
BigDecimal specLength
BigDecimal specWidth
BigDecimal specHeight
}
PACKAGE_TYPE {
Long id PK
String code
String name
String nameEng
}
PURCHASE_CONTRACT_ITEM {
Long id PK
Long skuId FK
List<Long> packageType
String packageTypeName
String packageTypeEngName
Integer qtyPerOuterbox
Integer qtyPerInnerbox
BigDecimal packageLength
BigDecimal packageWidth
BigDecimal packageHeight
JsonWeight singleGrossweight
JsonAmount packagingPrice
}
SKU ||--o{ PURCHASE_CONTRACT_ITEM : "包含"
PACKAGE_TYPE ||--o{ PURCHASE_CONTRACT_ITEM : "应用于"
```

**Diagram sources**
- [SkuDO.java](file://eplus-module-pms/eplus-module-pms-biz/src/main/java/com/syj/eplus/module/pms/dal/dataobject/sku/SkuDO.java)
- [PackageTypeDTO.java](file://eplus-module-pms/eplus-module-pms-api/src/main/java/com/syj/eplus/module/pms/api/packageType/dto/PackageTypeDTO.java)
- [PurchaseContractItemDO.java](file://eplus-module-scm/eplus-module-scm-biz/src/main/java/com/syj/eplus/module/scm/dal/dataobject/purchasecontractitem/PurchaseContractItemDO.java)

### 数据一致性维护

当用户在采购合同中选择包装方式后，系统会通过`PackageTypeApi`获取对应的`PackageTypeDTO`，并将ID列表存储在`packageType`字段中，同时将名称拼接后存入`packageTypeName`字段。这种设计保证了数据的灵活性和查询效率。

**Section sources**
- [PurchaseContractServiceImpl.java](file://eplus-module-scm/eplus-module-scm-biz/src/main/java/com/syj/eplus/module/scm/service/purchasecontract/PurchaseContractServiceImpl.java)
- [PurchaseContractItemAndContractInfoRespVO.java](file://eplus-module-scm/eplus-module-scm-biz/src/main/java/com/syj/eplus/module/scm/controller/admin/purchasecontractitem/vo/PurchaseContractItemAndContractInfoRespVO.java)

## 包装方式在业务流程中的应用场景

包装方式数据模型在多个核心业务流程中扮演着关键角色，确保了信息的准确传递和业务的顺利执行。

### 报价环节

在销售报价时，包装成本是报价单的重要组成部分。系统会根据所选SKU关联的包装方式及其规格参数，计算出包装材料成本和预估的物流成本，从而生成更精确的报价。

### 采购环节

采购环节是包装方式应用最直接的场景。
- **采购合同创建**: 采购员在创建采购合同时，必须为每个采购项选择包装方式，并填写内/外箱装量、包装尺寸、单品毛重等规格参数。
- **成本核算**: 系统根据包装价和采购数量，自动计算出包装总成本。
- **供应商沟通**: 采购合同中的包装信息是与供应商沟通的核心内容，确保供应商按要求进行包装。

### 物流环节

物流部门依据采购合同或销售合同中的包装规格（长、宽、高、毛重）来计算货物的体积重量，安排合适的运输工具和仓储空间，并生成装箱单。

### 质检环节

在质检环节，质检员需要根据合同约定的包装方式进行核对。`QualityInspectionItemSaveReqVO`中包含`packageType`字段，用于记录本次检验所依据的包装方式，确保检验标准与合同一致。

**Section sources**
- [PurchaseContractItemAndContractInfoRespVO.java](file://eplus-module-scm/eplus-module-scm-biz/src/main/java/com/syj/eplus/module/scm/controller/admin/purchasecontractitem/vo/PurchaseContractItemAndContractInfoRespVO.java)
- [QualityInspectionItemSaveReqVO.java](file://eplus-module-qms/eplus-module-qms-biz/src/main/java/com/syj/eplus/module/qms/controller/admin/qualityinspection/vo/QualityInspectionItemSaveReqVO.java)
- [TransformNoticeMidVO.java](file://eplus-module-scm/eplus-module-scm-biz/src/main/java/com/syj/eplus/module/scm/controller/admin/purchasecontract/vo/TransformNoticeMidVO.java)

## 包装方式变更管理方案

为了确保历史单据的数据一致性，系统对包装方式的变更采用了严格的管理方案，核心原则是“变更不影响历史”。

### 变更不影响历史

一旦包装方式被应用于任何业务单据（如已创建的采购合同），该包装方式的定义（如名称、代码）将被锁定，不允许直接修改。任何对包装方式的修改需求，都必须通过创建新的变更流程来实现。

### 历史数据一致性保障

当一个采购合同被创建并保存后，其明细项中的`packageTypeName`字段已经存储了当时包装方式的名称快照。即使未来系统中的包装方式名称被修改，该采购合同上显示的名称也不会改变，从而保证了历史单据的原始性和准确性。

### 变更流程

对于需要修改包装方式的情况，系统应提供专门的“包装方式变更”审批流程。该流程会创建一个新的包装方式记录，并更新相关SKU或物料清单（BOM）的引用，确保未来的业务使用新的包装方式，而过去的业务记录保持不变。

**Section sources**
- [PurchaseContractItemDO.java](file://eplus-module-scm/eplus-module-scm-biz/src/main/java/com/syj/eplus/module/scm/dal/dataobject/purchasecontractitem/PurchaseContractItemDO.java)
- [PurchaseContractServiceImpl.java](file://eplus-module-scm/eplus-module-scm-biz/src/main/java/com/syj/eplus/module/scm/service/purchasecontract/PurchaseContractServiceImpl.java)

## 结论

本文档详细阐述了包装方式数据模型的设计与应用。该模型通过独立的包装类型定义、灵活的规格参数关联以及严谨的变更管理机制，有效地支持了报价、采购、物流和质检等核心业务流程。通过将包装方式与业务单据而非SKU直接关联，系统在保证数据灵活性的同时，也通过数据快照的方式确保了历史单据的一致性和可追溯性，为企业的精细化管理提供了坚实的数据基础。